<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Machine Yard - Rental System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/css/styles.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <style>
      .carousel-wrapper {
        display: flex;
        transition: transform 0.7s ease-in-out;
      }
    </style>
    <link rel="stylesheet" href="/css/styles.css" />
  </head>
  <body class="bg-gray-100">
    <div class="absolute opacity-90 w-full">
      <div class="relative w-full mx-auto overflow-hidden">
        <!-- Carousel Wrapper -->
        <div id="carousel" class="carousel-wrapper">
          <!-- Slide 1 -->
          <div class="min-w-full h-[100vh] relative">
            <img
              src="ic1 (1).jpeg"
              alt="jcb"
              class="w-full h-full object-cover"
            />
            <div
              class="absolute inset-0 flex flex-col justify-center items-center text-white bg-black bg-opacity-65"
            ></div>
          </div>
          <!-- Slide 2 -->
          <div class="min-w-full h-[100vh] relative">
            <img
              src="ic1 (2).jpeg"
              alt="tractor"
              class="w-full h-full object-cover"
            />
            <div
              class="absolute inset-0 flex flex-col justify-center items-center text-white bg-black bg-opacity-65"
            ></div>
          </div>
          <!-- Slide 3 -->
          <div class="min-w-full h-[100vh] relative">
            <img
              src="ic1 (3).jpeg"
              alt="harvestor"
              class="w-full h-full object-cover"
            />
            <div
              class="absolute inset-0 flex flex-col justify-center items-center text-white bg-black bg-opacity-65"
            ></div>
          </div>
        </div>

        <!-- Dots Navigation -->
        <div
          id="dots"
          class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex gap-2"
        >
          <div
            class="w-3 h-3 rounded-full cursor-pointer bg-white"
            data-index="0"
          ></div>
          <div
            class="w-3 h-3 rounded-full cursor-pointer bg-gray-500"
            data-index="1"
          ></div>
          <div
            class="w-3 h-3 rounded-full cursor-pointer bg-gray-500"
            data-index="2"
          ></div>
        </div>
      </div>
    </div>
    <div
      id="content"
      class="min-h-screen flex items-center justify-center py-8 px-4 sm:px-6 lg:px-8"
    >
      <div class="max-w-md w-full space-y-4 z-50">
        <div>
          <div class="relative">
            <img
              src="./logo.jpeg"
              alt="MY"
              class="w-9 absolute left-16 bottom-1"
            />
            <h1 class="text-4xl font-extrabold text-center text-white mb-2">
              Machine Yard
            </h1>
          </div>

          <p class="text-center text-white">
            Your One-Stop Solution for Machine Rentals
          </p>
        </div>

        <!-- Register Form -->
        <div class="bg-white px-6 py-5 rounded-xl shadow-lg max-w-md mx-auto">
          <h2 class="text-xl font-semibold mb-3 text-gray-800">
            Create Your Account
          </h2>
          <form id="registerForm" class="space-y-3">
            <!-- Name -->
            <div>
              <label class="block text-sm font-medium text-gray-600 mb-1"
                >Name</label
              >
              <input
                type="text"
                name="name"
                class="w-full px-3 py-1.5 border border-gray-200 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent transition duration-150"
                required
              />
              <p class="error-message text-red-500 text-sm mt-1 hidden"></p>
            </div>

            <!-- Email -->
            <div>
              <label class="block text-sm font-medium text-gray-600 mb-1"
                >Email</label
              >
              <input
                type="email"
                name="email"
                class="w-full px-3 py-1.5 border border-gray-200 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent transition duration-150"
                required
              />
              <p class="error-message text-red-500 text-sm mt-1 hidden"></p>
            </div>

            <!-- Password -->
            <div class="relative">
              <label class="block text-sm font-medium text-gray-600 mb-1"
                >Password</label
              >
              <div class="relative">
                <input
                  type="password"
                  name="password"
                  id="passwordInput"
                  class="w-full px-3 py-1.5 border border-gray-200 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent transition duration-150"
                  required
                />
                <button
                  type="button"
                  id="togglePassword"
                  class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600"
                >
                  <!-- Eye icon (visible when password is hidden) -->
                  <svg
                    id="eyeIcon"
                    class="h-5 w-5"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                    />
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
                    />
                  </svg>
                  <!-- Eye-slash icon (visible when password is shown) -->
                  <svg
                    id="eyeSlashIcon"
                    class="h-5 w-5 hidden"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.542-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.542 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"
                    />
                  </svg>
                </button>
              </div>
              <p class="error-message text-red-500 text-sm mt-1 hidden"></p>
            </div>

            <!-- Role -->
            <div>
              <label class="block text-sm font-medium text-gray-600 mb-1"
                >Role</label
              >
              <select
                name="role"
                class="w-full px-3 py-1.5 border border-gray-200 rounded-md text-sm bg-white focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent transition duration-150"
              >
                <option value="user">User</option>
                <option value="owner">Machine Owner</option>
                <option value="admin">Admin</option>
              </select>
            </div>

            <!-- Submit Button -->
            <button
              type="submit"
              class="w-full bg-blue-600 text-white py-2 px-4 rounded-md text-sm font-medium hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 transition duration-200"
            >
              Register
            </button>
          </form>

          <!-- Login Link -->
          <p class="mt-3 text-center text-sm text-gray-500">
            Already have an account?
            <a
              href="/login.html"
              class="font-medium text-blue-600 hover:text-blue-700 transition duration-150"
            >
              Login here
            </a>
          </p>
        </div>
      </div>
    </div>

    <script src="/js/utils.js"></script>
    <script>
      const routes = {
        "/user/dashboard": "user-dashboard.html",
        "/user/book": "user-booking.html",
        "/owner/dashboard": "owner-dashboard.html",
        "/owner/add-machine": "owner-add-machine.html",
        "/owner/edit-machine": "/owner-edit-machine.html",
        "/admin/dashboard": "admin-dashboard.html",
      };

      function loadPage() {
        const path = window.location.pathname;
        if (path === "/" || path === "/index.html") return; // Show registration
        const page = routes[path];
        if (page) {
          fetch(page)
            .then((res) => {
              if (!res.ok)
                throw new Error(`Failed to load ${page}: ${res.status}`);
              return res.text();
            })
            .then((html) => {
              document.getElementById("content").innerHTML = html;
              utils.showToast(`Loaded ${path}`, "success"); // Debug
            })
            .catch((err) => {
              console.error(err);
              utils.showToast(`Error loading page: ${err.message}`, "error");
            });
        } else {
          utils.showToast(`Page not found: ${path}`, "error");
        }
      }

      window.onload = loadPage;
      window.onpopstate = loadPage;

      document
        .getElementById("registerForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          document.querySelectorAll(".error-message").forEach((el) => {
            el.textContent = "";
            el.classList.add("hidden");
          });

          const formData = new FormData(e.target);
          const validationRules = {
            name: { required: true, minLength: 3 },
            email: { required: true, pattern: /^[^\s@]+@[^\s@]+\.[^\s@]+$/ },
            password: { required: true, minLength: 6 },
          };

          const errors = utils.validateForm(formData, validationRules);
          if (Object.keys(errors).length > 0) {
            for (const [field, message] of Object.entries(errors)) {
              const errorElement =
                e.target.elements[field].parentElement.querySelector(
                  ".error-message"
                );
              errorElement.textContent = message;
              errorElement.classList.remove("hidden");
            }
            return;
          }

          const data = {
            name: formData.get("name"),
            email: formData.get("email"),
            password: formData.get("password"),
            role: formData.get("role"),
          };

          try {
            const spinner = utils.showLoading("registerForm");
            const response = await fetch(
              "https://machine-yard.vercel.app/api/auth/register",
              {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data),
              }
            );

            utils.hideLoading(spinner);

            if (response.ok) {
              utils.showToast("Registration successful!", "success");
              setTimeout(() => {
                window.location.href = "/login.html";
              }, 1000);
            } else {
              const result = await response.json();
              utils.showToast(result.error || "Registration failed", "error");
            }
          } catch (error) {
            utils.hideLoading(spinner);
            utils.showToast("Error: " + error.message, "error");
          }
        });

      const carousel = document.getElementById("carousel");
      const dots = document.querySelectorAll("#dots div");
      let currentIndex = 0;
      const totalSlides = 3; // Number of slides

      // Function to update carousel position
      function updateCarousel() {
        carousel.style.transform = `translateX(-${currentIndex * 100}%)`;
        dots.forEach((dot, index) => {
          dot.classList.toggle("bg-white", index === currentIndex);
          dot.classList.toggle("bg-gray-500", index !== currentIndex);
        });
      }

      // Next slide
      function nextSlide() {
        currentIndex = (currentIndex + 1) % totalSlides;
        updateCarousel();
      }

      // Previous slide
      function prevSlide() {
        currentIndex = currentIndex === 0 ? totalSlides - 1 : currentIndex - 1;
        updateCarousel();
      }

      // Auto-slide every 3 seconds
      let autoSlide = setInterval(nextSlide, 3000);

      // Dot navigation
      dots.forEach((dot) => {
        dot.addEventListener("click", () => {
          clearInterval(autoSlide); // Pause auto-slide on manual interaction
          currentIndex = parseInt(dot.getAttribute("data-index"));
          updateCarousel();
          autoSlide = setInterval(nextSlide, 3000); // Resume auto-slide
        });
      });

      // Initial setup
      updateCarousel();

      document
        .getElementById("togglePassword")
        .addEventListener("click", function (e) {
          e.preventDefault(); // Prevent any default behavior

          const passwordInput = document.getElementById("passwordInput");
          const eyeIcon = document.getElementById("eyeIcon");
          const eyeSlashIcon = document.getElementById("eyeSlashIcon");

          // Toggle password visibility
          const isPassword = passwordInput.getAttribute("type") === "password";
          passwordInput.setAttribute("type", isPassword ? "text" : "password");

          // Toggle icons
          eyeIcon.classList.toggle("hidden");
          eyeSlashIcon.classList.toggle("hidden");
        });
    </script>
  </body>
</html>
